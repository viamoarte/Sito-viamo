<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- GOOGLE VERIFICATION – INCOLLALO QUI IL TUO -->
    <meta name="google-site-verification" content="lPFhcE-c-br4rc_BGTJxWi7R9cGN7DbIuo5zwVLRAvA" />
    <!-- SEO -->
    <title>ViAmo - Vincenza Amodio | Arte abitata</title>
    <meta name="description" content="Portfolio ufficiale di ViAmo (Vincenza Amodio), artista di pop art contemporanea. Opere su tela, tessuti jaquard e lino di canapa.">
    <meta name="keywords" content="ViAmo, Vincenza Amodio, pop art contemporanea, pop art, artista italiana, arte, pittura, quadri">
    <meta name="author" content="ViAmo Art">
    <meta name="robots" content="index, follow">
    <meta name="description" content="Scopri le opere uniche di ViAmo, artista di pop art contemporanea.">
    <meta name="keywords" content="ViAmo, Vincenza Amodio, arte, galleria, pop art">
    <meta name="author" content="ViAmo Art">
    <title>ViAmo - Artista contemporanea</title>
    <!-- Open Graph -->
    <meta property="og:title" content="ViAmo - Vincenza Amodio | Pop Art">
    <meta property="og:description" content="Opere uniche di pop art contemporanea dell'artista ViAmo.">
    <meta property="og:image" content="https://viamoarte.github.io/Sito-viamo/Opere/banner.webp">
    <meta property="og:url" content="https://viamoarte.github.io/Sito-viamo/">
    <meta property="og:type" content="website">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>(function(){emailjs.init("z2kCGkszIchfP51G_");})();</script>
    <style>
        body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f0f0f0;}
        header{background:#2c3e50;color:#fff;padding:15px;text-align:center;position:relative;}
        #banner{width:100%;max-height:350px;object-fit:cover;display:block;}
        nav{background:#34495e;padding:10px;text-align:center;}
        nav a{color:#fff;margin:0 15px;text-decoration:none;font-size:1.1em;}
        nav a:hover{text-decoration:underline;}
        section{padding:25px;margin:20px;background:#fff;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1);}
        CSS.gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    grid-auto-rows: 12px;          /* base piccola per il calcolo dell'altezza */
    gap: 20px;
    padding: 10px;
    align-content: start;          /* importante per non stirare tutto */
}

.artwork {
    display: grid;                 /* ← chiave per far funzionare height:100% */
    grid-auto-rows: 1fr;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #ddd;
    /* padding: 15px;              ← meglio toglierlo qui o gestirlo dentro */
    box-sizing: border-box;
}

.artwork img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
    display: block;
}

/* Tentativo masonry nativo (funziona in alcuni browser nel 2026, altrimenti fallback) */
@supports (grid-template-rows: masonry) {
    .gallery {
        grid-template-rows: masonry;
        grid-auto-rows: auto;
    }
}

/* Fallback più morbido per i browser vecchi */
@supports not (grid-template-rows: masonry) {
    .gallery {
        grid-auto-rows: 240px;     /* altezza media di compromesso */
    }
}
        
        .artwork a,.artwork button{display:inline-block;margin:8px 4px 0;padding:8px 14px;background:#2c3e50;color:#fff;text-decoration:none;border:none;border-radius:5px;font-size:.9em;cursor:pointer;}
        .artwork a:hover,.artwork button:hover{background:#34495e;}
        form{display:flex;flex-direction:column;max-width:450px;margin:0 auto;}
        input,textarea{margin:10px 0;padding:12px;border:1px solid #ccc;border-radius:5px;font-size:1em;}
        input[type=file]{margin:10px 0;padding:8px;}
        button{background:#2c3e50;color:#fff;border:none;padding:12px;border-radius:5px;cursor:pointer;font-size:1em;}
        button:hover{background:#34495e;}
        #admin{display:none;}
        .error{color:red;display:none;text-align:center;margin:10px 0;}
        .feedback{padding:10px;border-radius:5px;margin:10px 0;text-align:center;}
        .feedback.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
        .feedback.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
        .preview-img{max-width:100%;max-height:150px;margin:10px 0;border-radius:5px;display:none;}
        .password-change{background:#f9f9f9;padding:15px;border-radius:8px;margin-top:20px;}
        .admin-section{margin-bottom:30px;}
        .github-sync span{color:green;font-weight:bold;}
        .warning{color:#d35400;font-weight:bold;}
        .import-section{background:#e8f5e9;padding:15px;border-radius:8px;margin-top:20px;}
        .placeholder{background:#eee;color:#999;font-style:italic;text-align:center;padding:20px;border-radius:5px;}
        @media (max-width:600px){nav a{display:block;margin:10px 0;}.gallery{grid-template-columns:1fr;}}
    </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BLDKGBVBF7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BLDKGBVBF7');
</script>
</head>
<body>
    <header>
        <img id="banner" src="Opere/banner.webp" alt="Banner ViAmo" loading="lazy">
        <h1>ViAmo - Vincenza Amodio</h1>
    </header>
    <nav>
        <a href="#home">Home</a>
        <a href="#gallery">Galleria</a>
        <a href="#about">Chi Sono</a>
        <a href="#contact">Contatti</a>
        <a href="#" onclick="toggleAdmin()">Area Riservata</a>
    </nav>
    <section id="home"><h2>Home</h2><p id="home-text">Caricamento...</p></section>
    <section id="gallery"><h2>Galleria Opere</h2><div class="gallery" id="gallery-container"></div></section>
    <section id="about"><h2>Chi è ViAmo</h2><p id="about-text">Caricamento...</p></section>
   
    <section id="contact">
        <h2>Contattami</h2>
        <form id="contact-form">
            <input type="text" name="user_name" placeholder="Il tuo nome" required>
            <input type="email" name="user_email" placeholder="La tua email" required>
            <textarea name="message" placeholder="Il tuo messaggio" rows="5" required></textarea>
            <button type="submit">Invia Messaggio</button>
            <div id="form-feedback"></div>
        </form>
    </section>
    <section id="admin">
        <h2>Area Amministratore</h2>
        <div id="login-section">
            <form id="login-form">
                <input type="password" id="admin-password" placeholder="Password Admin" required>
                <div class="error" id="login-error">Password errata.</div>
                <button type="submit">Accedi</button>
            </form>
        </div>
        <div id="admin-panel" style="display:none;">
            <button onclick="logout()">Esci</button>
            <button onclick="forceSyncFromGitHub()" style="background:#9b59b6;margin-left:10px;">Forza Sync GitHub</button>
           
            <div class="admin-section">
                <h3>Modifica Banner</h3>
                <form id="banner-form">
                    <input type="file" id="banner-file" accept="image/*">
                    <img id="banner-preview" class="preview-img" alt="Anteprima">
                    <button type="submit">Carica Banner (→ WebP)</button>
                    <div id="banner-feedback"></div>
                </form>
            </div>
            <div class="admin-section">
                <h3>Testo Home</h3>
                <form id="home-form"><textarea id="new-home-text" rows="4" required></textarea><button type="submit">Aggiorna</button></form>
            </div>
            <div class="admin-section">
                <h3>Testo Chi è ViAmo</h3>
                <form id="about-form"><textarea id="new-about-text" rows="4" required></textarea><button type="submit">Aggiorna</button></form>
            </div>
            <div class="admin-section">
                <h3>Aggiungi/Modifica Opera</h3>
                <p class="warning">Max 8MB</p>
                <form id="gallery-form">
                    <input type="text" id="gallery-title" placeholder="Titolo" required>
                    <input type="text" id="gallery-desc" placeholder="Descrizione" required>
                    <input type="text" id="gallery-dimensions" placeholder="Dimensioni" required>
                    <input type="file" id="gallery-image-file" accept="image/*">
                    <img id="preview-main" class="preview-img" alt="Anteprima">
                    <input type="file" id="gallery-rendering-file" accept="image/*">
                    <img id="preview-rendering" class="preview-img" alt="Anteprima rendering">
                    <button type="submit" id="gallery-submit-btn">Aggiungi Opera</button>
                    <button type="button" onclick="cancelEdit()" id="cancel-edit" style="display:none;background:#e74c3c;">Annulla</button>
                    <div id="gallery-feedback"></div>
                </form>
            </div>
            <div class="admin-section">
                <h3>GitHub Sync</h3>
                <p class="github-sync">Dati da GitHub: <span id="github-status">In attesa...</span></p>
                <button onclick="exportData()" style="background:#27ae60;">Esporta JSON</button>
                <button onclick="pushToGitHub()" style="background:#6f42c1;margin-left:10px;">PUSH SU GITHUB</button>
                <div id="github-feedback"></div>
            </div>
            <div class="import-section">
                <h3>Ripristina da Backup (data.json)</h3>
                <p>Carica un file <code>data.json</code> per ripristinare opere, testi e banner</p>
                <input type="file" id="import-json-file" accept=".json,application/json">
                <button onclick="importFromJson()" style="background:#e67e22;margin-top:10px;">IMPORTA E RIPRISTINA TUTTO</button>
                <div id="import-feedback"></div>
            </div>
            <div class="password-change">
                <h3>Cambia Password</h3>
                <form id="password-form">
                    <input type="password" id="old-password" placeholder="Attuale" required>
                    <input type="password" id="new-password" placeholder="Nuova (min 10)" required minlength="10">
                    <input type="password" id="confirm-password" placeholder="Conferma" required>
                    <button type="submit">Cambia</button>
                    <div id="password-feedback"></div>
                </form>
            </div>
        </div>
    </section>
    <footer>© 2025 ViAmo Art. Tutti i diritti riservati.</footer>
    <script>
        const GITHUB_DATA_URL = 'https://raw.githubusercontent.com/viamoarte/Sito-viamo/main/data.json';
        const GITHUB_API = 'https://api.github.com/repos/viamoarte/Sito-viamo/contents/data.json';
        let artworks = [], homeText = '', aboutText = '', bannerData = 'Opere/banner.webp';
        let adminPasswordHash = '';
        let loggedIn = false, editingId = null;
// PULIZIA AUTOMATICA ALL'APERTURA
window.addEventListener('load', () => {
    //localStorage.clear(); // Forza sempre dati freschi da GitHub
});
        // PASSWORD DEFAULT
        (async () => {
            const hash = await crypto.subtle.digest('SHA-256', new TextEncoder().encode('#Viamo2025'));
            const defaultHash = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
            if (!localStorage.getItem('adminPasswordHash')) localStorage.setItem('adminPasswordHash', defaultHash);
            adminPasswordHash = localStorage.getItem('adminPasswordHash');
        })();

        function loadData() {
            artworks = JSON.parse(localStorage.getItem('artworks') || '[]');
            homeText = localStorage.getItem('homeText') || "ViAmo trasforma emozioni in arte.";
            aboutText = localStorage.getItem('aboutText') || "Vincenza Amodio, in arte ViAmo.";
            bannerData = localStorage.getItem('bannerData') || 'Opere/banner.webp';
        }

        async function loadFromGitHub() {
            try {
                const res = await fetch(GITHUB_DATA_URL + '?t=' + Date.now());
                if (!res.ok) throw 0;
                const data = await res.json();
                if (!localStorage.getItem('artworks')) {
                    artworks = data.artworks || [];
                    homeText = data.homeText || homeText;
                    aboutText = data.aboutText || aboutText;
                    bannerData = data.bannerData || bannerData;
                    ['artworks','homeText','aboutText','bannerData'].forEach(k =>
                        localStorage.setItem(k, k==='artworks' ? JSON.stringify(artworks) : (k==='homeText'?homeText:(k==='aboutText'?aboutText:bannerData)))
                    );
                }
                document.getElementById('github-status').textContent = 'SÌ';
                document.getElementById('github-status').style.color = 'green';
            } catch {
                document.getElementById('github-status').textContent = 'NO';
                document.getElementById('github-status').style.color = 'red';
            }
        }

        function renderAll() {
            document.getElementById('home-text').textContent = homeText;
            document.getElementById('about-text').textContent = aboutText;
            document.getElementById('banner').src = bannerData + '?t=' + Date.now();
            renderGallery();
        }

        function renderGallery() {
            const c = document.getElementById('gallery-container');
            c.innerHTML = artworks.map(a => `
                <div class="artwork">
                    <img src="${a.image}?t=${Date.now()}" alt="${a.title}" loading="lazy"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM5OTkiPkltbWFnaW5lIG1hbmNhbnRlPC90ZXh0Pjwvc3ZnPg=='; this.title='Immagine non trovata su GitHub';">
                    <h3>${a.title}</h3>
                    <p>Dimensioni: ${a.dimensions}</p>
                    <a href="artwork.html?id=${a.id}">Dettagli</a>
                    ${loggedIn ? `<button onclick="startEdit(${a.id})">Modifica</button>
                                 <button onclick="deleteArtwork(${a.id})" style="background:#e74c3c;">Elimina</button>` : ''}
                </div>
            `).join('');
        }

        function compressToWebP(file, cb) {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const max = 1200;
                canvas.width = img.width > max ? max : img.width;
                canvas.height = img.height * (canvas.width / img.width);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                cb(canvas.toDataURL('image/webp', 0.8));
            };
            img.src = URL.createObjectURL(file);
        }

        function previewFile(inputId, previewId) {
            const file = document.getElementById(inputId).files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById(previewId).src = e.target.result;
                    document.getElementById(previewId).style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
// CONFIG EMAILJS
        const SERVICE_ID = 'service_rdfzdc8';
        const TEMPLATE_TO_ADMIN = 'template_pxpn0pv';     // A te
        const TEMPLATE_AUTOREPLY = 'template_07bn298';    // Risposta automatica
// CONTATTO - INVIO EMAIL (FUNZIONANTE)
document.getElementById('contact-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = this.user_name.value.trim();
    const email = this.user_email.value.trim();
    const message = this.message.value.trim();

    if (!name || !email || !message) {
        showFeedback('form-feedback', 'Compila tutti i campi!', false);
        return;
    }

    showFeedback('form-feedback', 'Invio in corso...', true);

    emailjs.send('service_rdfzdc8', 'template_pxpn0pv', {
        from_name: name,
        from_email: email,
        message: message
    })
    .then(() => {
        showFeedback('form-feedback', 'Messaggio inviato con successo!', true);
        this.reset();
    })
    .catch((error) => {
        console.error('Errore EmailJS:', error);
        showFeedback('form-feedback', 'Errore invio. Riprova.', false);
    });
});
        // BANNER
        document.getElementById('banner-form').addEventListener('submit', e => {
            e.preventDefault();
            const file = document.getElementById('banner-file').files[0];
            if (!file) return showFeedback('banner-feedback', 'Seleziona file!', false);
            compressToWebP(file, dataUrl => {
                const filename = 'banner.webp';
                localStorage.setItem('pendingBannerFile', dataUrl.split(',')[1]);
                localStorage.setItem('pendingBannerName', filename);
                bannerData = 'Opere/' + filename;
                localStorage.setItem('bannerData', bannerData);
                document.getElementById('banner').src = dataUrl;
                showFeedback('banner-feedback', 'Banner convertito in WebP! Usa PUSH', true);
            });
        });

        // OPERE
        document.getElementById('gallery-form').addEventListener('submit', e => {
            e.preventDefault();
            const title = document.getElementById('gallery-title').value.trim();
            const desc = document.getElementById('gallery-desc').value.trim();
            const dimensions = document.getElementById('gallery-dimensions').value.trim();
            const imageFile = document.getElementById('gallery-image-file').files[0];
            const renderFile = document.getElementById('gallery-rendering-file').files[0];

            const data = { title, desc, dimensions };

            if (editingId) {
                const art = artworks.find(x => x.id === editingId);
                data.image = art.image;
                data.rendering = art.rendering || undefined;
            }

            if (imageFile) {
                const imageFilename = Date.now() + '.webp';
                compressToWebP(imageFile, imgDataUrl => {
                    localStorage.setItem('pendingImage_' + imageFilename, imgDataUrl.split(',')[1]);
                    data.image = 'Opere/' + imageFilename;
                    processRendering();
                });
            } else {
                processRendering();
            }

            function processRendering() {
                if (renderFile) {
                    const renderFilename = Date.now() + '_render.webp';
                    compressToWebP(renderFile, rendDataUrl => {
                        localStorage.setItem('pendingImage_' + renderFilename, rendDataUrl.split(',')[1]);
                        data.rendering = 'Opere/' + renderFilename;
                        saveArtwork(data);
                    });
                } else {
                    saveArtwork(data);
                }
            }

            function saveArtwork(data) {
                if (editingId) {
                    const i = artworks.findIndex(x => x.id === editingId);
                    artworks[i] = { id: editingId, ...data };
                    cancelEdit();
                } else {
                    artworks.push({ id: Date.now(), ...data });
                }
                localStorage.setItem('artworks', JSON.stringify(artworks));
                renderGallery();
                showFeedback('gallery-feedback', editingId ? 'Modificata!' : 'Aggiunta! Usa PUSH', true);
                e.target.reset();
                document.querySelectorAll('.preview-img').forEach(img => img.style.display = 'none');
            }
        });

        // START EDIT
        function startEdit(id) {
            const art = artworks.find(x => x.id === id);
            editingId = id;
            document.getElementById('gallery-title').value = art.title;
            document.getElementById('gallery-desc').value = art.desc;
            document.getElementById('gallery-dimensions').value = art.dimensions;
            document.getElementById('preview-main').src = art.image;
            document.getElementById('preview-main').style.display = 'block';
            if (art.rendering) {
                document.getElementById('preview-rendering').src = art.rendering;
                document.getElementById('preview-rendering').style.display = 'block';
            }
            document.getElementById('gallery-submit-btn').textContent = 'Salva Modifiche';
            document.getElementById('cancel-edit').style.display = 'inline-block';
            document.getElementById('gallery-image-file').removeAttribute('required');
        }

        // PUSH
        async function pushToGitHub() {
            const token = prompt("GitHub PAT (repo: read+write)");
            if (!token) return showFeedback('github-feedback', 'PAT richiesto!', false);

            showFeedback('github-feedback', 'Caricamento...', true);

            try {
                const data = { artworks, homeText, aboutText, bannerData };
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                const sha = (await fetch(GITHUB_API).then(r => r.json())).sha;

                await fetch(GITHUB_API, {
                    method: 'PUT',
                    headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'Update data.json', content, sha })
                });

                const pending = Object.keys(localStorage).filter(k => k.startsWith('pendingImage_') || k === 'pendingBannerFile');
                let uploaded = 0;

                for (const key of pending) {
                    const filename = key === 'pendingBannerFile' ? localStorage.getItem('pendingBannerName') : key.replace('pendingImage_', '');
                    const base64 = localStorage.getItem(key);
                    const apiUrl = `https://api.github.com/repos/viamoarte/Sito-viamo/contents/Opere/${filename}`;
                    await fetch(apiUrl, {
                        method: 'PUT',
                        headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: `Upload ${filename}`, content: base64 })
                    });
                    localStorage.removeItem(key);
                    if (key === 'pendingBannerFile') localStorage.removeItem('pendingBannerName');
                    uploaded++;
                }

                showFeedback('github-feedback', 
                    `SYNC COMPLETO!<br>${uploaded} immagini WebP caricate<br>
                     <a href="https://github.com/viamoarte/Sito-viamo/tree/main/Opere" target="_blank" style="color:#007bff;">
                     Vedi su GitHub
                     </a>`, 
                    true);
                setTimeout(() => location.reload(), 2000);
            } catch (err) {
                showFeedback('github-feedback', 'Errore: PAT non valido', false);
            }
        }

        function showFeedback(id, msg, ok = true) {
            const el = document.getElementById(id);
            el.innerHTML = `<div class="feedback ${ok?'success':'error'}">${msg}</div>`;
            setTimeout(() => el.innerHTML = '', 10000);
        }

        function exportData() {
            localStorage.setItem('artworks', JSON.stringify(artworks));
            localStorage.setItem('homeText', homeText);
            localStorage.setItem('aboutText', aboutText);
            localStorage.setItem('bannerData', bannerData);
            const data = { artworks, homeText, aboutText, bannerData };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.json';
            a.click();
            URL.revokeObjectURL(url);
            showFeedback('github-feedback', `Esportato! (${artworks.length} opere)<br><strong>Usa PUSH per sincronizzare</strong>`, true);
        }

        function importFromJson() {
            const fileInput = document.getElementById('import-json-file');
            const file = fileInput.files[0];
            if (!file) return showFeedback('import-feedback', 'Seleziona un file!', false);
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm("Ripristinare TUTTO?")) {
                        artworks = data.artworks || [];
                        homeText = data.homeText || homeText;
                        aboutText = data.aboutText || aboutText;
                        bannerData = data.bannerData || bannerData;
                        localStorage.setItem('artworks', JSON.stringify(artworks));
                        localStorage.setItem('homeText', homeText);
                        localStorage.setItem('aboutText', aboutText);
                        localStorage.setItem('bannerData', bannerData);
                        showFeedback('import-feedback', 'Ripristinato! Ricaricamento...', true);
                        setTimeout(() => location.reload(), 1500);
                    }
                } catch {
                    showFeedback('import-feedback', 'File non valido!', false);
                }
            };
            reader.readAsText(file);
        }

        // LOGIN
        document.getElementById('login-form').addEventListener('submit', async e => {
            e.preventDefault();
            const input = document.getElementById('admin-password').value;
            const hash = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(input));
            const inputHash = Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
            if (inputHash === adminPasswordHash) {
                loggedIn = true;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('new-home-text').value = homeText;
                document.getElementById('new-about-text').value = aboutText;
                renderGallery();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        });

        // FUNZIONI GLOBALI
        function toggleAdmin() { document.getElementById('admin').style.display = document.getElementById('admin').style.display === 'block' ? 'none' : 'block'; }
        function logout() { loggedIn = false; editingId = null; document.getElementById('login-section').style.display = 'block'; document.getElementById('admin-panel').style.display = 'none'; renderGallery(); }
        function forceSyncFromGitHub() { if(confirm("Sovrascrivere tutto con GitHub?")) { localStorage.clear(); location.reload(); } }
        function cancelEdit() { editingId = null; document.getElementById('gallery-form').reset(); document.querySelectorAll('.preview-img').forEach(img => img.style.display = 'none'); document.getElementById('gallery-submit-btn').textContent = 'Aggiungi Opera'; document.getElementById('cancel-edit').style.display = 'none'; document.getElementById('gallery-image-file').setAttribute('required', ''); }
        function deleteArtwork(id) { if (confirm('Eliminare?')) { artworks = artworks.filter(a => a.id !== id); localStorage.setItem('artworks', JSON.stringify(artworks)); renderGallery(); showFeedback('gallery-feedback', 'Eliminata!'); } }

        // EVENTI
        document.getElementById('banner-file').addEventListener('change', () => previewFile('banner-file', 'banner-preview'));
        document.getElementById('gallery-image-file').addEventListener('change', () => previewFile('gallery-image-file', 'preview-main'));
        document.getElementById('gallery-rendering-file').addEventListener('change', () => previewFile('gallery-rendering-file', 'preview-rendering'));
        ['home','about'].forEach(s => {
            document.getElementById(s+'-form').addEventListener('submit', e => {
                e.preventDefault();
                const val = document.getElementById('new-'+s+'-text').value.trim();
                if (s==='home') homeText = val; else aboutText = val;
                localStorage.setItem(s+'Text', val);
                document.getElementById(s+'-text').textContent = val;
            });
        });

        // INIT
        async function init() {
    await loadFromGitHub();     // aspetta che finisca il fetch da GitHub
    loadData();                 // ora legge i dati aggiornati
    renderAll();                // e solo adesso disegna
}

init();   // avvia tutto

        // ESPOSIZIONE
        window.toggleAdmin = toggleAdmin;
        window.logout = logout;
        window.forceSyncFromGitHub = forceSyncFromGitHub;
        window.startEdit = startEdit;
        window.cancelEdit = cancelEdit;
        window.deleteArtwork = deleteArtwork;
        window.pushToGitHub = pushToGitHub;
        window.exportData = exportData;
        window.importFromJson = importFromJson;
    </script>
</body>
</html>



















