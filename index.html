<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViAmo - Vincenza Amodio</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>(function(){emailjs.init("z2kCGkszIchfP51G_");})();</script>
    <style>
        body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f0f0f0;}
        header{background:#2c3e50;color:#fff;padding:20px;text-align:center;}
        #banner{width:100%;max-height:400px;object-fit:cover;}
        nav{background:#34495e;padding:15px;text-align:center;}
        nav a{color:#fff;margin:0 15px;text-decoration:none;font-size:1.1em;}
        nav a:hover{text-decoration:underline;}
        section{padding:30px;margin:20px;background:#fff;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1);}
        .gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px;padding:20px;}
        .artwork{border:1px solid #ddd;padding:20px;text-align:center;background:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.1);}
        .artwork img{width:100%;height:220px;object-fit:cover;border-radius:8px;}
        .artwork button,.artwork a{display:inline-block;margin:10px 5px;padding:10px 16px;background:#2c3e50;color:#fff;text-decoration:none;border:none;border-radius:5px;cursor:pointer;}
        .artwork button:hover,.artwork a:hover{background:#34495e;}
        button{background:#2c3e50;color:#fff;border:none;padding:12px 20px;border-radius:5px;cursor:pointer;margin:10px 5px;}
        button:hover{background:#34495e;}
        input,textarea,select{margin:10px 0;padding:12px;border:1px solid #ccc;border-radius:5px;width:100%;box-sizing:border-box;}
        #admin{display:none;background:#fff;padding:30px;border-radius:10px;margin:20px;box-shadow:0 0 20px rgba(0,0,0,.2);}
        .feedback{padding:15px;border-radius:5px;margin:15px 0;text-align:center;font-weight:bold;}
        .success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
        .error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
        .preview-img{max-width:100%;max-height:200px;margin:15px 0;border-radius:8px;display:none;}
        @media (max-width:600px){nav a{display:block;margin:15px 0;}}
    </style>
</head>
<body>
    <header>
        <img id="banner" src="Opere/banner.jpg" alt="ViAmo Art" loading="lazy">
        <h1>ViAmo - Vincenza Amodio</h1>
    </header>
    <nav>
        <a href="#home">Home</a>
        <a href="#gallery">Galleria</a>
        <a href="#about">Chi Sono</a>
        <a href="#contact">Contatti</a>
        <a href="javascript:toggleAdmin()">Area Riservata</a>
    </nav>

    <section id="home"><h2>Home</h2><div id="home-text">Caricamento...</div></section>
    <section id="gallery"><h2>Galleria Opere</h2><div class="gallery" id="gallery-container"></div></section>
    <section id="about"><h2>Chi è ViAmo</h2><div id="about-text">Caricamento...</div></section>

    <section id="contact">
        <h2>Contattami</h2>
        <form id="contact-form">
            <input type="text" name="user_name" placeholder="Nome" required>
            <input type="email" name="user_email" placeholder="Email" required>
            <textarea name="message" placeholder="Messaggio" rows="6" required></textarea>
            <button type="submit">Invia Messaggio</button>
            <div id="form-feedback"></div>
        </form>
    </section>

    <section id="admin">
        <h2>Area Amministratore</h2>
        <div id="login-section">
            <input type="password" id="admin-pass" placeholder="Password" required>
            <button onclick="login()">Accedi</button>
            <div id="login-error" class="error" style="display:none;">Password errata!</div>
        </div>

        <div id="admin-panel" style="display:none;">
            <button onclick="logout()" style="background:#e74c3c;">Esci</button>

            <h3>Gestione Dati</h3>
            <input type="file" id="import-file" accept=".json" style="display:none;">
            <button onclick="document.getElementById('import-file').click()">Importa data.json</button>
            <button onclick="exportData()">Esporta data.json</button>
            <button onclick="syncGitHub()">Sync GitHub</button>
            <div id="sync-msg"></div>

            <h3>Banner</h3>
            <input type="file" id="banner-file" accept="image/*">
            <img id="banner-preview" class="preview-img" alt="">
            <button onclick="updateBanner()">Aggiorna Banner</button>

            <h3>Testo Home (HTML ok)</h3>
            <textarea id="home-input" rows="6"></textarea>
            <button onclick="saveHome()">Salva Home</button>

            <h3>Testo Chi Sono</h3>
            <textarea id="about-input" rows="6"></textarea>
            <button onclick="saveAbout()">Salva Chi Sono</button>

            <h3>Aggiungi/Modifica Opera</h3>
            <form id="art-form">
                <input type="text" id="title" placeholder="Titolo" required>
                <input type="text" id="desc" placeholder="Descrizione" required>
                <input type="text" id="dim" placeholder="Dimensioni" required>
                <input type="number" id="price" placeholder="Prezzo €" required>
                <input type="file" id="img-main" accept="image/*" required>
                <img id="prev-main" class="preview-img" alt="">
                <input type="file" id="img-rend" accept="image/*">
                <img id="prev-rend" class="preview-img" alt="">
                <button type="submit">Salva Opera</button>
                <button type="button" onclick="resetForm()" id="cancel-btn" style="display:none;background:#e74c3c;">Annulla</button>
            </form>
            <div id="art-msg"></div>

            <h3>Cambia Password</h3>
            <input type="password" id="old-p" placeholder="Vecchia">
            <input type="password" id="new-p" placeholder="Nuova">
            <button onclick="changePass()">Cambia</button>
            <div id="pass-msg"></div>
        </div>
    </section>

    <footer>© 2025 ViAmo Art. Tutti i diritti riservati.</footer>

    <script>
        let data = { artworks: [], homeText: "", aboutText: "", banner: "Opere/banner.jpg" };
        let editingId = null;
        const PASS_HASH = "adminHash";
        let hash = localStorage.getItem(PASS_HASH) || btoa("ViAmo2025!");
        if (!localStorage.getItem(PASS_HASH)) localStorage.setItem(PASS_HASH, hash);

        function $(id) { return document.getElementById(id); }

        function load() {
            const saved = localStorage.getItem("viamo_data");
            if (saved) data = JSON.parse(saved);
            $("home-text").innerHTML = data.homeText || "Benvenuta nel mondo di ViAmo!";
            $("about-text").innerHTML = data.aboutText || "Vincenza Amodio, in arte ViAmo...";
            $("banner").src = data.banner + "?t=" + Date.now();
            renderGallery();
        }

        function save() {
            localStorage.setItem("viamo_data", JSON.stringify(data));
        }

        function renderGallery() {
            const container = $("gallery-container");
            container.innerHTML = data.artworks.map(a => `
                <div class="artwork">
                    <img src="${a.image}" alt="${a.title}" loading="lazy">
                    <h3>${a.title}</h3>
                    <p>${a.desc}</p>
                    <p>Dimensioni: ${a.dim}</p>
                    <p>Prezzo: €${a.price}</p>
                    <a href="artwork.html?id=${a.id}">Dettagli</a>
                    ${location.hash === "#admin" ? `
                        <button onclick="edit(${a.id})">Modifica</button>
                        <button onclick="del(${a.id})" style="background:#e74c3c;">Elimina</button>
                    ` : ''}
                </div>
            `).join('');
        }

        window.login = () => {
            if (btoa($("admin-pass").value) === hash) {
                $("login-section").style.display = "none";
                $("admin-panel").style.display = "block";
                $("home-input").value = data.homeText;
                $("about-input").value = data.aboutText;
                location.hash = "#admin";
                renderGallery();
            } else {
                $("login-error").style.display = "block";
            }
        };

        window.logout = () => {
            $("login-section").style.display = "block";
            $("admin-panel").style.display = "none";
            $("admin-pass").value = "";
            location.hash = "";
            renderGallery();
        };

        window.toggleAdmin = () => {
            $("admin").style.display = $("admin").style.display === "block" ? "none" : "block";
        };

        window.edit = (id) => {
            const art = data.artworks.find(a => a.id === id);
            editingId = id;
            $("title").value = art.title;
            $("desc").value = art.desc;
            $("dim").value = art.dim;
            $("price").value = art.price;
            $("prev-main").src = art.image; $("prev-main").style.display = "block";
            if (art.rendering) { $("prev-rend").src = art.rendering; $("prev-rend").style.display = "block"; }
            $("art-form").querySelector("button[type=submit]").textContent = "Salva Modifiche";
            $("cancel-btn").style.display = "inline-block";
        };

        window.del = (id) => {
            if (confirm("Eliminare?")) {
                data.artworks = data.artworks.filter(a => a.id !== id);
                save(); renderGallery();
                msg("art-msg", "Opera eliminata!", true);
            }
        };

        window.resetForm = () => {
            editingId = null;
            $("art-form").reset();
            document.querySelectorAll(".preview-img").forEach(i => i.style.display = "none");
            $("art-form").querySelector("button[type=submit]").textContent = "Salva Opera";
            $("cancel-btn").style.display = "none";
        };

        $("art-form").onsubmit = (e) => {
            e.preventDefault();
            const f = e.target;
            const file = f.img-main.files[0];
            if (!file) return msg("art-msg", "Immagine principale obbligatoria!", false);

            const reader = new FileReader();
            reader.onload = () => {
                const art = {
                    id: editingId || Date.now(),
                    title: f.title.value,
                    desc: f.desc.value,
                    dim: f.dim.value,
                    price: f.price.value,
                    image: reader.result
                };
                if (f.img-rend.files[0]) {
                    const r2 = new FileReader();
                    r2.onload = () => { art.rendering = r2.result; saveArt(art); };
                    r2.readAsDataURL(f.img-rend.files[0]);
                } else saveArt(art);
            };
            reader.readAsDataURL(file);
        };

        function saveArt(art) {
            if (editingId) {
                const i = data.artworks.findIndex(a => a.id === editingId);
                data.artworks[i] = art;
                msg("art-msg", "Modificata!", true);
            } else {
                data.artworks.push(art);
                msg("art-msg", "Aggiunta!", true);
            }
            save(); renderGallery(); resetForm();
        }

        ["img-main","img-rend","banner-file"].forEach(id => {
            $(id).onchange = () => {
                const file = $(id).files[0];
                if (file) {
                    const prev = id === "banner-file" ? "banner-preview" : id === "img-main" ? "prev-main" : "prev-rend";
                    const r = new FileReader();
                    r.onload = () => { $(prev).src = r.result; $(prev).style.display = "block"; };
                    r.readAsDataURL(file);
                }
            };
        });

        window.updateBanner = () => {
            const file = $("banner-file").files[0];
            if (!file) return msg("sync-msg", "Seleziona immagine!", false);
            const r = new FileReader();
            r.onload = () => {
                data.banner = r.result;
                save();
                $("banner").src = data.banner + "?t=" + Date.now();
                msg("sync-msg", "Banner aggiornato!", true);
            };
            r.readAsDataURL(file);
        };

        window.saveHome = () => { data.homeText = $("home-input").value; save(); $("home-text").innerHTML = data.homeText; msg("sync-msg", "Home aggiornato!", true); };
        window.saveAbout = () => { data.aboutText = $("about-input").value; save(); $("about-text").innerHTML = data.aboutText; msg("sync-msg", "Chi Sono aggiornato!", true); };

        window.changePass = () => {
            const old = $("old-p").value;
            const nw = $("new-p").value;
            if (btoa(old) !== hash) return msg("pass-msg", "Password attuale errata!", false);
            if (nw.length < 6) return msg("pass-msg", "Minimo 6 caratteri!", false);
            hash = btoa(nw);
            localStorage.setItem(PASS_HASH, hash);
            msg("pass-msg", "Password cambiata!", true);
            $("old-p").value = $("new-p").value = "";
        };

        $("import-file").onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const r = new FileReader();
            r.onload = () => {
                try {
                    data = JSON.parse(r.result);
                    save();
                    load();
                    msg("sync-msg", "Importato con successo!", true);
                } catch { msg("sync-msg", "File non valido!", false); }
            };
            r.readAsText(file);
        };

        window.exportData = () => {
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url; a.download = "data.json"; a.click();
            msg("sync-msg", "Esportato!", true);
        };

        window.syncGitHub = () => {
            const url = "https://raw.githubusercontent.com/viamoarte/Sito-viamo/main/data.json";
            fetch(url).then(r => r.json()).then(d => {
                data = d;
                save();
                load();
                msg("sync-msg", "Sincronizzato da GitHub!", true);
            }).catch(() => msg("sync-msg", "Errore GitHub", false));
        };

        function msg(id, text, ok = true) {
            const el = $(id);
            el.innerHTML = `<div class="feedback ${ok ? "success" : "error"}">${text}</div>`;
            setTimeout(() => el.innerHTML = "", 4000);
        }

        $("contact-form").onsubmit = (e) => {
            e.preventDefault();
            emailjs.send("service_rdfzdc8", "template_pxpn0pv", {
                to_email: "viamoarte@gmail.com",
                user_name: e.target.user_name.value,
                user_email: e.target.user_email.value,
                message: e.target.message.value
            }).then(() => {
                msg("form-feedback", "Messaggio inviato!", true);
                e.target.reset();
            }).catch(() => msg("form-feedback", "Errore invio", false));
        };

        load();
        if (location.hash === "#admin") login();
    </script>
</body>
</html>
